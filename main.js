(()=>{"use strict";const e=class{constructor(e){this.name=e,this.gameboard=new o}randomShipPlacement=()=>{this.gameboard.ships.forEach((e=>{let t=Math.floor(10*Math.random())+1,r=Math.floor(10*Math.random())+1,o=Math.random()>.5?"x":"y";for(;!1===e.placed;)this.gameboard.placeShip(e,t,r,o),t=Math.floor(10*Math.random())+1,r=Math.floor(10*Math.random())+1,o=Math.random()>.5?"x":"y"}))};randomAttack=()=>[Math.floor(10*Math.random())+1,Math.floor(10*Math.random())+1]},t=e=>{for(let t=1;t<=10;t++)for(let r=1;r<=10;r++){const o=document.createElement("div");o.setAttribute("xy-coord",`${r}-${t}`),e.appendChild(o)}};document.querySelectorAll(".drag-item").forEach((e=>{e.addEventListener("dragstart",(t=>{e.classList.add("dragging"),t.dataTransfer.setData("ShipName",t.target.id),t.dataTransfer.setData("ShipAxis",t.target.getAttribute("data-axis"))}))})),document.querySelectorAll(".drag-item").forEach((e=>{e.addEventListener("dragend",(()=>{e.classList.remove("dragging")}))}));const r=(e,t,r,o)=>{const a=o.querySelector(`[xy-coord="${e}-${t}"]`),i=e-1,s=t-1;"object"==typeof r.gameboard.grid[s][i]?a.style.backgroundColor="green":a.style.backgroundColor="blue"},o=class{constructor(){this.grid=this.createGrid(),this.ships=this.createShips()}createShips=()=>[{name:"carrier",length:5},{name:"battleship",length:4},{name:"destroyer",length:3},{name:"submarine",length:3},{name:"patrol-boat",length:2}].map((e=>new class{constructor(e,t){this.name=e,this.length=t,this.sunk=!1,this.sectionsHit=Array(t).fill(""),this.placed=!1}hit=e=>{this.sectionsHit[e-1]="x",this.isSunk()};isSunk=()=>{this.sectionsHit.every((e=>"x"==e))&&(this.sunk=!0)}}(e.name,e.length)));createGrid=()=>{const e=[];for(let t=0;t<10;t++){e.push([]);for(let r=0;r<10;r++)e[t].push("")}return e};placeShip=(e,t,r,o)=>{const a=r-1,i=t-1;if(this.checkForEnoughSpace(a,i,e.length,o)&&this.checkForExistingShip(a,i,e.length,o)){for(let t=0;t<e.length;t++)"x"==o?this.grid[i][a+t]={ship:e,position:t+1}:"y"==o&&(this.grid[i+t][a]={ship:e,position:t+1});return e.placed=!0,!0}};checkForExistingShip=(e,t,r,o)=>{if("x"==o)return this.grid[t].slice(e,e+r).every((e=>""==e));if("y"==o){const o=[];for(let a=0;a<r;a++)o.push(this.grid[t+a][e]);return o.every((e=>""==e))}};checkForEnoughSpace=(e,t,r,o)=>"x"==o?this.grid[t].slice(e,e+r).length==r:"y"==o?t+r<=10:void 0;receiveAttack=(e,t)=>{const r=e-1,o=t-1;if("object"==typeof this.grid[o][r]){const e=this.grid[o][r].ship,t=this.grid[o][r].position;e.hit(t)}else this.grid[o][r]="x"};checkAllShipsSunk=()=>this.ships.every((e=>e.sunk))},a=(document.querySelector("#start-game"),document.querySelector("#gameboard-1"),document.querySelector("#gameboard-2")),i=new e("Jon"),s=new e("CPU");var n,c;s.randomShipPlacement(),t(document.querySelector("#gameboard-1")),t(document.querySelector("#gameboard-2")),n=document.querySelector("#gameboard-1"),c=i,n.querySelectorAll("[xy-coord]").forEach((e=>{e.addEventListener("dragover",(e=>{e.preventDefault()})),e.addEventListener("drop",(t=>{const r=t.dataTransfer.getData("ShipName"),o=t.dataTransfer.getData("ShipAxis"),a=((e,t)=>t.gameboard.ships.find((t=>t.name==e)))(r,c),[i,s]=e.getAttribute("xy-coord").split("-");if(c.gameboard.placeShip(a,s,i,o)){const t=document.querySelector(".dragging");e.appendChild(t)}console.log(c)}))})),((e,t)=>{t.querySelectorAll("[xy-coord]").forEach((o=>{o.addEventListener("click",(o=>{const[a,i]=o.target.getAttribute("xy-coord").split("-");r(a,i,e,t),e.gameboard.receiveAttack(a,i),console.log(e)}))}))})(s,document.querySelector("#gameboard-2")),document.querySelector("#rotate-btn").addEventListener("click",(()=>{(()=>{const e=document.querySelector("#rotate-btn");"x"==e.getAttribute("data-rotation")?((()=>{const e=document.querySelector("#ships-container");e.querySelectorAll(".drag-item").forEach((e=>{const t=e.offsetWidth;e.style.height=t/16+"rem",e.style.width="2.5rem",e.style.flexDirection="column",e.setAttribute("data-axis","y")})),e.style.flexDirection="row"})(),e.setAttribute("data-rotation","y")):((()=>{const e=document.querySelector("#ships-container");e.querySelectorAll(".drag-item").forEach((e=>{const t=e.offsetHeight;e.style.height="2.5rem",e.style.width=t/16+"rem",e.style.flexDirection="row",e.setAttribute("data-axis","x")})),e.style.flexDirection="column"})(),e.setAttribute("data-rotation","x"))})()})),a.querySelectorAll("[xy-coord]").forEach((e=>{e.addEventListener("click",(()=>{const[e,t]=i.randomAttack();i.gameboard.receiveAttack(e,t),r(e,t,i,document.querySelector("#gameboard-1")),console.log(e,t),console.log(i),i.gameboard.checkAllShipsSunk()&&alert("Player 1 lost"),s.gameboard.checkAllShipsSunk()&&alert("Player 2 lost")}))}))})();